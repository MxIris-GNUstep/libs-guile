#
#  Makefile for Greg Library and control program
#  
#  Copyright (C) 1998, 2001, 2003 Free Software Foundation, Inc.
#
#  Written by:	Richard Frith-Macdonald <rfm@gnu.org>
#  Modifed by:  Nicola Pero <n.pero@mi.flashne.it>
# 
#  This file is part of Greg (part of the GNUstep project)
#
#  This library is free software; you can redistribute it and/or
#  modify it under the terms of the GNU Lesser General Public
#  License as published by the Free Software Foundation; either
#  version 2.1 of the License, or (at your option) any later version.
#  
#  This library is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#  Lesser General Public License for more details.
#  
#  You should have received a copy of the GNU Lesser General Public
#  License along with this library; if not, write to the Free Software
#  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#

SH = /bin/sh

CC = @CC@
CFLAGS = -g
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
SED = sed

# New versions of libtool only work if SED is defined, so we need to export
# it from the makefile.
export SED

GUILE_SCM_PATH = @GUILE_SCM_PATH@

MAJOR_VERSION = @MAJOR_VERSION@
MINOR_VERSION = @MINOR_VERSION@

VER_INFO = $(MAJOR_VERSION):$(MINOR_VERSION)

# Let libtool manage the trouble of library permissions !
INSTALL_LIBRARY =       $(SH) ../install-sh -c
INSTALL_DATA   =	$(SH) ../install-sh -c -m 0644
INSTALL_SCRIPT =	$(SH) ../install-sh -c -m 0755

LIBTOOL =		$(SH) ../libtool
LIBTOOL_COMPILE =       $(LIBTOOL) --mode=compile
LIBTOOL_LINK =          $(LIBTOOL) --mode=link
LIBTOOL_INSTALL =       $(LIBTOOL) --mode=install
LIBTOOL_CLEAN =         $(LIBTOOL) --mode=clean

MKINSTDIRS =		$(SH) ../mkinstalldirs

GUILE_CFLAGS  = @GUILE_CFLAGS@
GUILE_LDFLAGS = @GUILE_LDFLAGS@
INCLUDES = $(GUILE_CFLAGS) -I$(prefix)/include

LIB = libgreg.la
LIB_SOURCES = greg.c
LIB_OBJECTS =  greg.lo
LIB_LDFLAGS = -rpath $(libdir) -version-info $(VER_INFO) -export-dynamic

all: $(LIB)

$(LIB): $(LIB_OBJECTS)
	$(LIBTOOL_LINK) \
	  $(CC) $(CFLAGS) $(LDFLAGS) $(GUILE_LDFLAGS) -o $@ \
	        $(LIB_LDFLAGS) $(LIB_OBJECTS) $(LIBS)

%.lo: %.c
	$(LIBTOOL_COMPILE) \
	  $(CC) $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) -c $<

# Create installation directories
create_install_dirs: $(INSTALL_ROOT_DIR)$(GUILE_SCM_PATH) \
$(INSTALL_ROOT_DIR)$(libdir) \
$(INSTALL_ROOT_DIR)$(bindir)

$(INSTALL_ROOT_DIR)$(GUILE_SCM_PATH):
	$(MKINSTDIRS) $@

$(INSTALL_ROOT_DIR)$(libdir):
	$(MKINSTDIRS) $@

$(INSTALL_ROOT_DIR)$(bindir):
	$(MKINSTDIRS) $@

install: $(LIB) create_install_dirs
	$(LIBTOOL_INSTALL) \
	  $(INSTALL_LIBRARY) $(LIB) $(INSTALL_ROOT_DIR)$(libdir)/ ; \
	$(INSTALL_DATA)   greg.scm $(INSTALL_ROOT_DIR)${GUILE_SCM_PATH}/ ; \
	$(INSTALL_SCRIPT) greg     $(INSTALL_ROOT_DIR)${bindir}/

uninstall:
	rm -rf $(INSTALL_ROOT_DIR)$(libdir)/$(LIB)
	rm -rf $(INSTALL_ROOT_DIR)${GUILE_SCM_PATH}/greg.scm
	rm -rf $(INSTALL_ROOT_DIR)${bindir}/greg

clean:
	rm -rf core *.o *.lo *.la .libs *.log *.dbg

distclean:	clean
	rm -rf greg greg.scm config.h test.* Makefile

